const game=require("./game"),gameConnector=require("./gameConnector"),Server=require("./server"),SessionsMap=new Map;function NewSession(e,t){const s=new Session(t);return SessionsMap.set(e,s),s.connector=new gameConnector.GameConnector,s.game=game.StartGame(s.settings.side,s.settings.stepTime,s.settings.field,s.settings.reverseLevel,s.connector),s.connector.Server=s.game,s.connector.ClientToServerCallbacks.StartMove=s.connector.Server.StartMove,s.connector.ServerToClientCallbacks.SetOccupation=function(t,s,o){let n="!Aset?";n+="S"+t+"?",n+="I"+s.toString()+"?",n+="O"+o.toString()+"?",Server.SendMessageToPlayersOfSession(e,n)},s.connector.ServerToClientCallbacks.AddTransfer=function(t,s,o,n,i){let a="!Atransfer?";a+="C"+t.toString()+"?",a+="F"+s+"?",a+="O"+o.toString()+"?",a+="T"+n+"?",a+="D"+i.toString()+"?",Server.SendMessageToPlayersOfSession(e,a)},s.connector.ServerToClientCallbacks.SetTurn=function(t){let o="!Aturn?";o+="T"+t+"?",o+="F"+game.FieldToString(s.game.topOccupations,s.game.bottomOccupations)+"?",Server.SendMessageToPlayersOfSession(e,o)},s.connector.ServerToClientCallbacks.Reverse=function(t){let s="!Areverse?";s+="S"+t+"?",Server.SendMessageToPlayersOfSession(e,s)},s.connector.ServerToClientCallbacks.GameOver=function(t){let s="!Aover?";s+="W"+t+"?",Server.SendMessageToPlayersOfSession(e,s),SessionsMap.delete(e)},s}function DeleteSession(e){SessionsMap.delete(e)}function GetSession(e){return SessionsMap.get(e)}function Session(e){this.bottomPlayer=null,this.topPlayer=null,this.bottomName=null,this.topName=null,this.status="Empty",this.connector=null,this.game=null,this.settings=e}module.exports.SessionsMap=SessionsMap,module.exports.NewSession=NewSession,module.exports.DeleteSession=DeleteSession,module.exports.GetSession=GetSession,module.exports.Session=Session,Session.prototype.connectPlayer=function(e,t,s){null!=s?s?(this.topPlayer=e,this.topName=t):(this.bottomPlayer=e,this.bottomName=t):null==this.bottomPlayer?(this.bottomPlayer=e,this.bottomName=t):(this.topPlayer=e,this.topName=t)},Session.prototype.disconnectPlayer=function(e){e?(this.topPlayer=null,this.topName=null):(this.bottomPlayer=null,this.bottomName=null)},Session.prototype.updateStatus=function(e){this.status=e},Session.prototype.statusAddPlayer=function(){return"Empty"===this.status?(this.updateStatus("Waiting"),!1):"Waiting"===this.status?(this.updateStatus("Full"),!0):"Conlost"===this.status?(this.updateStatus("Playing"),!0):void 0},Session.prototype.statusRemovePlayer=function(){return"Playing"===this.status?(this.updateStatus("Conlost"),!1):"Full"===this.status?(this.updateStatus("Waiting"),!1):"Conlost"===this.status?(this.updateStatus("Abandoned"),!0):"Waiting"===this.status?(this.updateStatus("Abandoned"),!0):void 0};